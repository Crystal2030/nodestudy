<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>List</title>
    <link rel="stylesheet" href="bootstrap.min.css"/>
</head>
<body>
<div class="form-horizontal" id="form">
    <div class="form-group">
        <label for="Username" class="col-sm-2 control-label">Username</label>
        <div class="col-sm-6">
            <input type="text" class="form-control" name="username" placeholder="Please input your name"/>
        </div>
    </div>
    <div class="form-group">
        <label for="Age" class="col-sm-2 control-label">Age</label>
        <div class="col-sm-6">
            <input type="text" class="form-control" name="age" placeholder="Please input your age"/>
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-offset-2">
            <button type="submit" class="btn btn-primary" id="add">Add</button>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <table class="table table-hover">
            <tr>
                <th>Name</th>
                <th>Age</th>
                <th>Operations</th>
            </tr>

        </table>
    </div>
</div>
</body>
</html>
<script src="jquery.min.js"></script>
<script>
    //Query
//    $('.table').hide();
    $.ajax({
        url: '/list',
        type: 'get',
        dataType: 'json',
        success: function(data){
            if(data.status == "success"){
                var str = '';
                $.each(data.value, function(index, item){
                    str += '<tr><td>'+ item.username +'</td><td>'+ item.age +'</td>' +
                            '<td class="col-sm-4">' +
                            '<button type="button" class="btn btn-info" id="edit">Edit</button>' +
                            '<button type="button" class="btn btn-warning col-sm-offset-1" id_attr="'+item.id+'" id="remove">Remove</button>' +
                            '</td></tr>';
                })
                $('.table').append(str);

                //Remove user
                $('#remove').on('click', function(){
                    console.log($(this).attr('id_attr'));
                    var id = $(this).attr('id_attr');
                    $.ajax({
                        url: '/remove',
                        type: 'post',
                        data: id,
                        dataType: 'json',
                        success: function(data){
                            if(data.status == 'success'){
                                console.log('remove success', data.value);
                                $.each(data.value, function(index, item){
                                    str += '<tr><td>'+ item.username +'</td><td>'+ item.age +'</td>' +
                                    '<td class="col-sm-4">' +
                                    '<button type="button" class="btn btn-info" id="edit">Edit</button>' +
                                    '<button type="button" class="btn btn-warning col-sm-offset-1" id_attr="'+item.id+'" id="remove">Remove</button>' +
                                    '</td></tr>';
                                })
                                $('.table').append(str);
                            }
                        },
                        error: function(xhr, status, err){
                            console.error('Add fail' + err);
                        }
                    });



                });

            }
        },
        error: function (xhr, status, err) {
            console.error(err);
        }
    });
    //Add user
    $('#add').on('click', function(){
//        $('.table').show();
//        $('#form').hide();
        add();
    });

    function add(){
        var username = $('input[name="username"]').val();
        var age = $('input[name="age"]').val();

        var user = {
            username: username,
            age: age
        };

        $.ajax({
            url: '/add',
            type: 'post',
            data: JSON.stringify(user),
            dataType: 'json',
            success: function(data){
                if(data.status == 'success'){
                    console.log('add success', data.value);
                    var str = '<tr><td>'+ data.value.username +'</td><td>'+ data.value.age +'</td>' +
                            '<td class="col-sm-4">' +
                            '<button type="button" class="btn btn-info" id="edit">Edit</button>' +
                            '<button type="button" class="btn btn-warning col-sm-offset-1" id="remove">Remove</button>' +
                            '</td></tr>';
                    $('.table').append(str);
                }
            },
            error: function(xhr, status, err){
                console.error('Add fail' + err);
            }
        });
    }


    function remove(){

    }

    //Edit user
    $('#edit').on('click', function(){

    });

    function edit(id){

    }

</script>